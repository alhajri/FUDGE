<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>fudge.gnd.resonances &#8212; Fudge and GND 4.2.2 beta documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '4.2.2 beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/gnd-20121206-favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Fudge and GND 4.2.2 beta documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for fudge.gnd.resonances</h1><div class="highlight"><pre>
<span></span><span class="c1"># &lt;&lt;BEGIN-copyright&gt;&gt;</span>
<span class="c1"># &lt;&lt;END-copyright&gt;&gt;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains the resonances, resolved and unresolved classes.</span>

<span class="sd">class hierarchy:</span>

<span class="sd">    * resonances contains one or more of scatteringRadius, resolved and unresolved</span>

<span class="sd">    * resolved and unresolved contain a list of energy regions. In each region,</span>

<span class="sd">        - resolved may have SLBW, MLBW, RM, RML formats</span>
<span class="sd">        - unresolved has L-dependant or E-dependant format</span>

<span class="sd">      each of these subsections has a list of resonances and attributes</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># TODO: move to a &#39;resonances&#39; module</span>

<span class="kn">import</span> <span class="nn">fractions</span>
<span class="kn">from</span> <span class="nn">pqu</span> <span class="k">import</span> <span class="n">PQU</span>
<span class="kn">from</span> <span class="nn">xData</span> <span class="k">import</span> <span class="n">XYs</span> <span class="k">as</span> <span class="n">XYsModule</span><span class="p">,</span> <span class="n">constant</span> <span class="k">as</span> <span class="n">constantModule</span><span class="p">,</span> <span class="n">link</span> <span class="k">as</span> <span class="n">linkModule</span><span class="p">,</span> <span class="n">table</span> <span class="k">as</span> <span class="n">tableModule</span>
<span class="kn">from</span> <span class="nn">fudge.gnd</span> <span class="k">import</span> <span class="n">suites</span> <span class="k">as</span> <span class="n">suitesModule</span>
<span class="kn">from</span> <span class="nn">fudge.gnd</span> <span class="k">import</span> <span class="n">abstractClasses</span> <span class="k">as</span> <span class="n">abstractClassesModule</span>

<span class="kn">import</span> <span class="nn">xData.ancestry</span> <span class="k">as</span> <span class="nn">ancestryModule</span>

<span class="n">__metaclass__</span> <span class="o">=</span> <span class="nb">type</span>


<div class="viewcode-block" id="resonances"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonances">[docs]</a><span class="k">class</span> <span class="nc">resonances</span><span class="p">(</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span> <span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    This is the top-level class for storing resonance parameters.</span>
<span class="sd">    For light targets it may contain only a scattering radius. For heavier targets it typically</span>
<span class="sd">    contains a resolved and/or unresolved section.</span>
<span class="sd">    </span>
<span class="sd">    resonances also has a boolean flag &#39;reconstructCrossSection&#39;. If False, either the cross section</span>
<span class="sd">    has already been reconstructed, or the parameters are given for information only and no reconstruction</span>
<span class="sd">    should be performed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;resonances&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scatteringRadius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolved</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unresolved</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">scatteringRadius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">resolved</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">unresolved</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Resonances should contain scattering radius OR resonance parameters, not both&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span> <span class="o">=</span> <span class="n">scatteringRadius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resolved</span> <span class="o">=</span> <span class="n">resolved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unresolved</span> <span class="o">=</span> <span class="n">unresolved</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolved</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unresolved</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">child</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">child</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        
    <span class="k">def</span>  <span class="nf">__str__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; string representation &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span> <span class="n">simpleString</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">)</span>

<div class="viewcode-block" id="resonances.check"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonances.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">info</span> <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">fudge.gnd</span> <span class="k">import</span> <span class="n">warning</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolved</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unresolved</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">section</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">warningList</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">warningList</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">context</span><span class="p">(</span> <span class="n">section</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="n">warningList</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">warnings</span></div>
    
<div class="viewcode-block" id="resonances.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonances.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span> <span class="p">)</span>
    
        <span class="n">xmlString</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolved</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unresolved</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unresolved</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span>
        <span class="k">return</span> <span class="n">xmlString</span></div>

<div class="viewcode-block" id="resonances.domain"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonances.domain">[docs]</a>    <span class="k">def</span> <span class="nf">domain</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">unitTo</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">asPQU</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return resonance region domain as a tuple of floats: (lowest edge, highest edge).</span>

<span class="sd">        options:</span>
<span class="sd">          unitTo: convert output to specified unit (given as a string).</span>
<span class="sd">          asPQU = True: return a tuple of PhysicalQuantityWithUncertainty instances instead of floats.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="p">:</span>
            <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">domainMax</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolved</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">multipleRegions</span><span class="p">:</span>
                <span class="n">bounds</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">reg</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="n">reg</span><span class="o">.</span><span class="n">domainMax</span><span class="p">)</span> <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">regions</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">domainMax</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unresolved</span><span class="p">:</span>
            <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unresolved</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unresolved</span><span class="o">.</span><span class="n">domainMax</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">bounds</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">bounds</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Resonance region boundaries don&#39;t match!&quot;</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">asPQU</span> <span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">unitTo</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span><span class="n">unitTo</span><span class="p">),</span> <span class="n">bounds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span><span class="n">unitTo</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">bounds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reconstructCrossSection</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolved</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">reconstructCrossSection</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unresolved</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">unresolved</span><span class="o">.</span><span class="n">reconstructCrossSection</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="resonances.parseXMLNode"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonances.parseXMLNode">[docs]</a>    <span class="k">def</span> <span class="nf">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">):</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>

        <span class="n">scatRadius</span><span class="p">,</span> <span class="n">RRR</span><span class="p">,</span> <span class="n">URR</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">element</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="o">==</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">moniker</span><span class="p">:</span>
                <span class="n">scatRadius</span> <span class="o">=</span> <span class="n">scatteringRadius</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="o">==</span><span class="n">resolved</span><span class="o">.</span><span class="n">moniker</span><span class="p">:</span>
                <span class="n">RRR</span> <span class="o">=</span> <span class="n">resolved</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="o">==</span><span class="n">unresolved</span><span class="o">.</span><span class="n">moniker</span><span class="p">:</span>
                <span class="n">URR</span> <span class="o">=</span> <span class="n">unresolved</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;unknown element &#39;</span><span class="si">%s</span><span class="s2">&#39; encountered in resonances!&quot;</span> <span class="o">%</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">resonances</span><span class="p">(</span> <span class="n">scatteringRadius</span> <span class="o">=</span> <span class="n">scatRadius</span><span class="p">,</span> <span class="n">resolved</span><span class="o">=</span><span class="n">RRR</span><span class="p">,</span> <span class="n">unresolved</span><span class="o">=</span><span class="n">URR</span> <span class="p">)</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span></div>
    
<div class="viewcode-block" id="resonances.toString"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonances.toString">[docs]</a>    <span class="k">def</span> <span class="nf">toString</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">simpleString</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a string representation of self. If simpleString is True, </span>
<span class="sd">        the string contains only an overview without listing resonances&quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;Resonances:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span> <span class="n">simpleString</span> <span class="o">=</span> <span class="n">simpleString</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolved</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span> <span class="n">simpleString</span> <span class="o">=</span> <span class="n">simpleString</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unresolved</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unresolved</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span> <span class="n">simpleString</span> <span class="o">=</span> <span class="n">simpleString</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span></div></div>


<span class="c1"># Q-value in resonance region may not be consistent with other parts of the evaluation</span>
<div class="viewcode-block" id="Q"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.Q">[docs]</a><span class="k">class</span> <span class="nc">Q</span><span class="p">(</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span> <span class="p">):</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s2">&quot;Q&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">unit</span> <span class="p">):</span>
        <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>

<div class="viewcode-block" id="Q.getValueAs"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.Q.getValueAs">[docs]</a>    <span class="k">def</span> <span class="nf">getValueAs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span><span class="s1">&#39;1. &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">factor</span></div>

<div class="viewcode-block" id="Q.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.Q.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span><span class="p">)</span>

        <span class="n">xml</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">)]</span>
        <span class="n">xml</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;constant value=&quot;</span><span class="si">%r</span><span class="s1">&quot; unit=&quot;</span><span class="si">%s</span><span class="s1">&quot;/&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">xml</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span>
        <span class="k">return</span> <span class="n">xml</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Q.parseXMLNode"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.Q.parseXMLNode">[docs]</a>    <span class="k">def</span> <span class="nf">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">):</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="n">Q</span><span class="p">(</span> <span class="nb">float</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)),</span> <span class="n">element</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unit&#39;</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tmp</span></div></div>


<span class="c1"># scatteringRadius can be constant, energy-dependent or L-dependent:</span>
<div class="viewcode-block" id="scatteringRadius"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.scatteringRadius">[docs]</a><span class="k">class</span> <span class="nc">scatteringRadius</span><span class="p">(</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span> <span class="p">):</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;scatteringRadius&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span> <span class="o">=</span> <span class="n">form</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">scatteringRadius</span><span class="p">):</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">==</span><span class="n">other</span><span class="o">.</span><span class="n">form</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">moniker</span>

    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>

<div class="viewcode-block" id="scatteringRadius.toString"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.scatteringRadius.toString">[docs]</a>    <span class="k">def</span> <span class="nf">toString</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">simpleString</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a string representation of self. If simpleString is True,</span>
<span class="sd">        the string contains only an overview without listing resonances&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">simpleString</span><span class="p">:</span> <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="scatteringRadius.check"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.scatteringRadius.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">info</span> <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks that the scattering radius is within a factor of 3 of the expected scattering radius</span>
<span class="sd">        of AP = 0.123 * self.target.getMass(&#39;amu&#39;)**(1./3.) + 0.08</span>

<span class="sd">        This default AP is roughly the nuclear radius, so getting within a factor of 3 of the default</span>
<span class="sd">        shouldn&#39;t be a problem.</span>

<span class="sd">        A similar test is included in PSYCHE, but PSYCHE&#39;s cannot handle LRF=7</span>
<span class="sd">        :param info:</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">fudge.gnd</span> <span class="k">import</span> <span class="n">warning</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;reactionSuite&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;reactionSuite&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">target</span> <span class="p">]</span>
        <span class="n">expectedAP</span> <span class="o">=</span> <span class="mf">10.0</span><span class="o">*</span><span class="p">(</span> <span class="mf">0.123</span> <span class="o">*</span> <span class="n">target</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s1">&#39;amu&#39;</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.08</span> <span class="p">)</span> <span class="c1"># expected radius in fm</span>
        <span class="n">factor</span><span class="o">=</span><span class="mf">3.0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isEnergyDependent</span><span class="p">():</span>
            <span class="n">egrid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">domainGrid</span>
<span class="c1"># BRB6 hardwired</span>
            <span class="n">APs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span> <span class="s1">&#39;fm&#39;</span><span class="p">,</span> <span class="n">energy_grid</span><span class="o">=</span><span class="n">egrid</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">iE</span><span class="p">,</span><span class="n">AP</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">APs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">AP</span><span class="o">/</span><span class="n">expectedAP</span> <span class="o">&gt;</span> <span class="n">factor</span> <span class="ow">or</span> <span class="n">AP</span><span class="o">/</span><span class="n">expectedAP</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="o">/</span><span class="n">factor</span><span class="p">:</span>
                    <span class="n">warning</span><span class="o">.</span><span class="n">badScatteringRadius</span><span class="p">(</span><span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">,</span> <span class="n">gotAP</span><span class="o">=</span><span class="n">AP</span><span class="p">,</span> <span class="n">expectedAP</span><span class="o">=</span><span class="n">expectedAP</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="n">egrid</span><span class="p">[</span><span class="n">iE</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="p">,</span> <span class="n">constantScatteringRadius</span><span class="p">):</span>    <span class="c1"># FIXME goes away once these are all converted to constant1d</span>
            <span class="n">AP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="s1">&#39;fm&#39;</span><span class="p">:</span>
                <span class="n">AP</span> <span class="o">*=</span> <span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span><span class="s1">&#39;1. &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s1">&#39;fm&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">AP</span><span class="o">/</span><span class="n">expectedAP</span> <span class="o">&gt;</span> <span class="n">factor</span> <span class="ow">or</span> <span class="n">AP</span><span class="o">/</span><span class="n">expectedAP</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="o">/</span><span class="n">factor</span><span class="p">:</span>
                <span class="n">warning</span><span class="o">.</span><span class="n">badScatteringRadius</span><span class="p">(</span><span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">,</span> <span class="n">gotAP</span><span class="o">=</span><span class="n">AP</span><span class="p">,</span> <span class="n">expectedAP</span><span class="o">=</span><span class="n">expectedAP</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">AP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">constant</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">rangeUnit</span> <span class="o">!=</span> <span class="s1">&#39;fm&#39;</span><span class="p">:</span>
                <span class="n">AP</span> <span class="o">*=</span> <span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">rangeUnit</span><span class="p">)</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s1">&#39;fm&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">AP</span><span class="o">/</span><span class="n">expectedAP</span> <span class="o">&gt;</span> <span class="n">factor</span> <span class="ow">or</span> <span class="n">AP</span><span class="o">/</span><span class="n">expectedAP</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="o">/</span><span class="n">factor</span><span class="p">:</span>
                <span class="n">warning</span><span class="o">.</span><span class="n">badScatteringRadius</span><span class="p">(</span><span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">,</span> <span class="n">gotAP</span><span class="o">=</span><span class="n">AP</span><span class="p">,</span> <span class="n">expectedAP</span><span class="o">=</span><span class="n">expectedAP</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">warnings</span></div>

<div class="viewcode-block" id="scatteringRadius.isEnergyDependent"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.scatteringRadius.isEnergyDependent">[docs]</a>    <span class="k">def</span> <span class="nf">isEnergyDependent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="p">,</span> <span class="n">XYsModule</span><span class="o">.</span><span class="n">XYs1d</span> <span class="p">)</span></div>

<div class="viewcode-block" id="scatteringRadius.getValueAs"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.scatteringRadius.getValueAs">[docs]</a>    <span class="k">def</span> <span class="nf">getValueAs</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">energy_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isEnergyDependent</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">energy_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s2">&quot;Missing: energy_grid to evaluate E-dependent scattering radius&quot;</span><span class="p">)</span>
            <span class="n">energy_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span>
            <span class="n">xScale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">domainUnitConversionFactor</span><span class="p">(</span> <span class="n">energy_unit</span> <span class="p">)</span>
            <span class="n">yScale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">rangeUnitConversionFactor</span><span class="p">(</span> <span class="n">unit</span> <span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span> <span class="n">yScale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span> <span class="n">xScale</span> <span class="o">*</span> <span class="n">e</span> <span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">energy_grid</span> <span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="p">,</span> <span class="n">constantScatteringRadius</span><span class="p">):</span>   <span class="c1"># FIXME goes away once these are converted to constant1d</span>
            <span class="n">oldUnit</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">unit</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">oldUnit</span><span class="p">)</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span> <span class="n">unit</span> <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">factor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">oldUnit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">rangeUnit</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">oldUnit</span><span class="p">)</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span> <span class="n">unit</span> <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">constant</span> <span class="o">*</span> <span class="n">factor</span></div>

<div class="viewcode-block" id="scatteringRadius.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.scatteringRadius.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>

        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span> <span class="p">)</span>

        <span class="n">xml</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">)]</span>
        <span class="n">xml</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xml</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span>
        <span class="k">return</span> <span class="n">xml</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="scatteringRadius.parseXMLNode"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.scatteringRadius.parseXMLNode">[docs]</a>    <span class="k">def</span> <span class="nf">parseXMLNode</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">):</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">constantModule</span><span class="o">.</span><span class="n">constant1d</span><span class="o">.</span><span class="n">moniker</span><span class="p">:</span> <span class="n">constantModule</span><span class="o">.</span><span class="n">constant1d</span><span class="p">,</span>
            <span class="n">constantScatteringRadius</span><span class="o">.</span><span class="n">moniker</span><span class="p">:</span> <span class="n">constantScatteringRadius</span><span class="p">,</span>
            <span class="n">XYsModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="o">.</span><span class="n">moniker</span><span class="p">:</span> <span class="n">XYsModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">,</span>
        <span class="p">}[</span> <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span> <span class="p">]</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
        <span class="n">SR</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span> <span class="n">form</span> <span class="p">)</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">SR</span></div></div>


<div class="viewcode-block" id="hardSphereRadius"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.hardSphereRadius">[docs]</a><span class="k">class</span> <span class="nc">hardSphereRadius</span><span class="p">(</span> <span class="n">scatteringRadius</span><span class="p">):</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;hardSphereRadius&#39;</span></div>


<div class="viewcode-block" id="baseScatteringRadiusForm"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.baseScatteringRadiusForm">[docs]</a><span class="k">class</span> <span class="nc">baseScatteringRadiusForm</span><span class="p">(</span> <span class="n">abstractClassesModule</span><span class="o">.</span><span class="n">form</span> <span class="p">)</span> <span class="p">:</span>

    <span class="k">pass</span></div>

<div class="viewcode-block" id="constantScatteringRadius"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.constantScatteringRadius">[docs]</a><span class="k">class</span> <span class="nc">constantScatteringRadius</span><span class="p">(</span> <span class="n">baseScatteringRadiusForm</span> <span class="p">):</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;constant&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">domainMin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">domainMax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">domainUnit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">baseScatteringRadiusForm</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="nb">str</span> <span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainMin</span> <span class="o">=</span> <span class="n">domainMin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainMax</span> <span class="o">=</span> <span class="n">domainMax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span> <span class="o">=</span> <span class="n">domainUnit</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">label</span><span class="p">,</span> <span class="nb">str</span> <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;label must be a string&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__label</span> <span class="o">=</span> <span class="n">label</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__label</span> <span class="p">)</span>

<div class="viewcode-block" id="constantScatteringRadius.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.constantScatteringRadius.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>

        <span class="n">attributeStr</span><span class="p">,</span> <span class="n">boundsString</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">attributeStr</span> <span class="o">+=</span> <span class="s1">&#39; label=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainMin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">boundsString</span> <span class="o">=</span> <span class="s1">&#39; domainMin=&quot;</span><span class="si">%s</span><span class="s1">&quot; domainMax=&quot;</span><span class="si">%s</span><span class="s1">&quot; domainUnit=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainMax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span> <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s%s</span><span class="s1"> value=&quot;</span><span class="si">%s</span><span class="s1">&quot; unit=&quot;</span><span class="si">%s</span><span class="s1">&quot; </span><span class="si">%s</span><span class="s1">/&gt;&#39;</span> <span class="o">%</span>
                 <span class="p">(</span> <span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="n">attributeStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">boundsString</span> <span class="p">)]</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="constantScatteringRadius.parseXMLNode"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.constantScatteringRadius.parseXMLNode">[docs]</a>    <span class="k">def</span> <span class="nf">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">):</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>
        <span class="n">CSR</span> <span class="o">=</span> <span class="n">constantScatteringRadius</span><span class="p">(</span> <span class="o">**</span><span class="n">getAttrs</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">CSR</span></div></div>


<div class="viewcode-block" id="spin"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.spin">[docs]</a><span class="k">class</span> <span class="nc">spin</span><span class="p">(</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store spins for a collection of resonances. Check denominator (must be integer or half-integer)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">):</span>
        <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Illegal spin &#39;</span><span class="si">%s</span><span class="s2">&#39;: must be integer or half-integer&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="parity"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.parity">[docs]</a><span class="k">class</span> <span class="nc">parity</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Store parity for a collection of resonances. Allowed values for the parity are +1 or -1.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parity</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parity</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> is not a legal value for parity!&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="n">parity</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span> <span class="p">)</span></div>


<div class="viewcode-block" id="resonanceParameters"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceParameters">[docs]</a><span class="k">class</span> <span class="nc">resonanceParameters</span><span class="p">(</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span> <span class="p">):</span>   <span class="c1"># FIXME: still needed? It&#39;s an extra level of nesting...</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Light-weight wrapper around a table.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;resonanceParameters&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
        <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="resonanceParameters.check"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceParameters.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">info</span> <span class="p">):</span>
        <span class="n">warnings</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">return</span> <span class="n">warnings</span></div>

<div class="viewcode-block" id="resonanceParameters.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceParameters.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span><span class="o">+</span><span class="s1">&#39;  &#39;</span>
        <span class="n">xmlList</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">)]</span>
        <span class="n">xmlList</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">xmlList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span>
        <span class="k">return</span> <span class="n">xmlList</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="resonanceParameters.parseXMLNode"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceParameters.parseXMLNode">[docs]</a>    <span class="k">def</span> <span class="nf">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">):</span>

        <span class="n">xPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>
        <span class="n">rps</span> <span class="o">=</span> <span class="n">resonanceParameters</span><span class="p">(</span> <span class="n">tableModule</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span>
            <span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">tableModule</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">moniker</span><span class="p">),</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">rps</span></div></div>


<span class="c1"># resolved/unresolved regions:</span>
<div class="viewcode-block" id="resolved"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resolved">[docs]</a><span class="k">class</span> <span class="nc">resolved</span><span class="p">(</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; class for resolved resonances &quot;&quot;&quot;</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;resolved&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formalism</span><span class="p">,</span> <span class="n">domainMin</span><span class="p">,</span> <span class="n">domainMax</span><span class="p">,</span> <span class="n">domainUnit</span><span class="p">,</span> <span class="n">reconstructCrossSection</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">reconstructAngularDistributions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">multipleRegions</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">multipleRegions</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formalism</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="n">formalism</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="n">formalism</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainMin</span> <span class="o">=</span> <span class="n">domainMin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainMax</span> <span class="o">=</span> <span class="n">domainMax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span> <span class="o">=</span> <span class="n">domainUnit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstructCrossSection</span> <span class="o">=</span> <span class="n">reconstructCrossSection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstructAngularDistributions</span> <span class="o">=</span> <span class="n">reconstructAngularDistributions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multipleRegions</span> <span class="o">=</span> <span class="n">multipleRegions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># contains multiple energyInterval (deprecated)</span>

<div class="viewcode-block" id="resolved.toString"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resolved.toString">[docs]</a>    <span class="k">def</span> <span class="nf">toString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simpleString</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;Resolved region with DEPRECATED multiple regions</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;Resolved resonances in </span><span class="si">%s</span><span class="s2"> form</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span></div>

<div class="viewcode-block" id="resolved.check"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resolved.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">info</span> <span class="p">):</span>
        <span class="kn">import</span> <span class="nn">warning</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multipleRegions</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">RRmultipleRegions</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">warningList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">warningList</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span><span class="n">warningList</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">warnings</span></div>
    
<div class="viewcode-block" id="resolved.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resolved.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span> <span class="p">)</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="s1">&#39; reconstructCrossSection=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reconstructCrossSection</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstructAngularDistributions</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">+=</span> <span class="s1">&#39; reconstructAngularDistributions=&quot;true&quot;&#39;</span>
        <span class="n">xmlString</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multipleRegions</span><span class="p">:</span>
            <span class="n">xmlString</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39; multipleRegions=&quot;true&quot; domainMin=&quot;</span><span class="si">%r</span><span class="s1">&quot; domainMax=&quot;</span><span class="si">%r</span><span class="s1">&quot; domainUnit=&quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainMax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span><span class="p">,</span> <span class="n">attrs</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">:</span>
                <span class="n">xmlString</span> <span class="o">+=</span> <span class="n">region</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xmlString</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39; domainMin=&quot;</span><span class="si">%r</span><span class="s1">&quot; domainMax=&quot;</span><span class="si">%r</span><span class="s1">&quot; domainUnit=&quot;</span><span class="si">%s</span><span class="s1">&quot; formalism=&quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainMax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="n">attrs</span> <span class="p">)</span>
            <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span>
        <span class="k">return</span> <span class="n">xmlString</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="resolved.parseXMLNode"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resolved.parseXMLNode">[docs]</a>    <span class="k">def</span> <span class="nf">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">):</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>
        <span class="k">def</span> <span class="nf">readResolved</span><span class="p">(</span> <span class="n">child</span> <span class="p">):</span>
            <span class="n">formClass</span> <span class="o">=</span> <span class="p">{</span><span class="n">SLBW</span><span class="o">.</span><span class="n">moniker</span><span class="p">:</span> <span class="n">SLBW</span><span class="p">,</span>
                    <span class="n">MLBW</span><span class="o">.</span><span class="n">moniker</span><span class="p">:</span> <span class="n">MLBW</span><span class="p">,</span>
                    <span class="n">RM</span><span class="o">.</span><span class="n">moniker</span><span class="p">:</span> <span class="n">RM</span><span class="p">,</span>
                    <span class="n">RMatrix</span><span class="o">.</span><span class="n">moniker</span><span class="p">:</span> <span class="n">RMatrix</span>
                    <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">formClass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;unknown resolved resonance form &#39;</span><span class="si">%s</span><span class="s2">&#39;!&quot;</span> <span class="o">%</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">formClass</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>

        <span class="n">regions</span> <span class="o">=</span> <span class="n">getBool</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;multipleRegions&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">regions</span><span class="p">:</span>
            <span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">):</span>
                <span class="n">resonanceSection</span> <span class="o">=</span> <span class="n">readResolved</span><span class="p">(</span> <span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">thisRegion</span> <span class="o">=</span> <span class="n">energyInterval</span><span class="p">(</span> <span class="n">formalism</span> <span class="o">=</span> <span class="n">resonanceSection</span><span class="p">,</span> <span class="o">**</span><span class="n">getAttrs</span><span class="p">(</span> <span class="n">region</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;formalism&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
                <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">thisRegion</span> <span class="p">)</span>
            <span class="n">RRR</span> <span class="o">=</span> <span class="n">resolved</span><span class="p">(</span> <span class="n">formalism</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">getAttrs</span><span class="p">(</span> <span class="n">element</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">RRR</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="n">regions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">formalism</span> <span class="o">=</span> <span class="n">readResolved</span><span class="p">(</span><span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">RRR</span> <span class="o">=</span> <span class="n">resolved</span><span class="p">(</span> <span class="n">formalism</span><span class="p">,</span> <span class="o">**</span><span class="n">getAttrs</span><span class="p">(</span> <span class="n">element</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;formalism&#39;</span><span class="p">,)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">RRR</span></div></div>


<div class="viewcode-block" id="unresolved"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.unresolved">[docs]</a><span class="k">class</span> <span class="nc">unresolved</span><span class="p">(</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span> <span class="p">):</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;unresolved&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formalism</span><span class="p">,</span> <span class="n">domainMin</span><span class="p">,</span> <span class="n">domainMax</span><span class="p">,</span> <span class="n">domainUnit</span><span class="p">,</span> <span class="n">reconstructCrossSection</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formalism</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="n">formalism</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="n">formalism</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span> <span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainMin</span> <span class="o">=</span> <span class="n">domainMin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainMax</span> <span class="o">=</span> <span class="n">domainMax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span> <span class="o">=</span> <span class="n">domainUnit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstructCrossSection</span> <span class="o">=</span> <span class="n">reconstructCrossSection</span>

    
<div class="viewcode-block" id="unresolved.toString"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.unresolved.toString">[docs]</a>    <span class="k">def</span> <span class="nf">toString</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">simpleString</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;Unresolved resonances in </span><span class="si">%s</span><span class="s2"> form</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span></div>

<div class="viewcode-block" id="unresolved.check"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.unresolved.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">info</span> <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">fudge.gnd</span> <span class="k">import</span> <span class="n">warning</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabulatedWidths</span><span class="o">.</span><span class="n">L_values</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="n">L</span><span class="o">.</span><span class="n">J_values</span><span class="p">:</span>
<span class="c1"># BRB6 hardwired</span>
                <span class="n">elist</span> <span class="o">=</span> <span class="n">J</span><span class="o">.</span><span class="n">energyDependentWidths</span><span class="o">.</span><span class="n">getColumn</span><span class="p">(</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">elist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">URRmissingEnergyList</span><span class="p">(</span> <span class="n">L</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="n">J</span><span class="o">.</span><span class="n">J</span><span class="p">,</span> <span class="n">J</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">elist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainMin</span> <span class="ow">or</span> <span class="n">elist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainMax</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">URRdomainMismatch</span><span class="p">(</span> <span class="n">L</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="n">J</span><span class="o">.</span><span class="n">J</span><span class="p">,</span> <span class="n">J</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="n">missingPoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">i1</span> <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">elist</span><span class="p">))</span> <span class="k">if</span> <span class="n">elist</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">*</span><span class="n">elist</span><span class="p">[</span><span class="n">i1</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">missingPoints</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">URRinsufficientEnergyGrid</span><span class="p">(</span> <span class="n">L</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="n">J</span><span class="o">.</span><span class="n">J</span><span class="p">,</span>
                            <span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span><span class="n">elist</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span><span class="p">),</span> <span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span><span class="n">elist</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span><span class="p">),</span> <span class="n">J</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">warnings</span></div>
    
<div class="viewcode-block" id="unresolved.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.unresolved.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span> <span class="p">)</span>

        <span class="n">reconstructString</span> <span class="o">=</span> <span class="s1">&#39; reconstructCrossSection=&quot;false&quot;&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstructCrossSection</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">xmlString</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1"> domainMin=&quot;</span><span class="si">%s</span><span class="s1">&quot; domainMax=&quot;</span><span class="si">%s</span><span class="s1">&quot; domainUnit=&quot;</span><span class="si">%s</span><span class="s1">&quot; formalism=&quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span>
                <span class="p">(</span> <span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainMax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="n">reconstructString</span> <span class="p">)</span> <span class="p">]</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span>
        <span class="k">return</span> <span class="n">xmlString</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="unresolved.parseXMLNode"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.unresolved.parseXMLNode">[docs]</a>    <span class="k">def</span> <span class="nf">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">):</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">unresolvedTabulatedWidths</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;tabulatedWidths&#39;</span><span class="p">),</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
        <span class="n">URR</span> <span class="o">=</span> <span class="n">unresolved</span><span class="p">(</span> <span class="n">formalism</span> <span class="o">=</span> <span class="n">table</span><span class="p">,</span> <span class="o">**</span><span class="n">getAttrs</span><span class="p">(</span> <span class="n">element</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;formalism&#39;</span><span class="p">,)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">URR</span></div></div>


<div class="viewcode-block" id="energyInterval"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.energyInterval">[docs]</a><span class="k">class</span> <span class="nc">energyInterval</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; resolved region may be made up of multiple energy intervals (deprecated) &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">,</span> <span class="n">formalism</span><span class="p">,</span> <span class="n">domainMin</span><span class="p">,</span> <span class="n">domainMax</span><span class="p">,</span> <span class="n">domainUnit</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="n">formalism</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainMin</span> <span class="o">=</span> <span class="n">domainMin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainMax</span> <span class="o">=</span> <span class="n">domainMax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span> <span class="o">=</span> <span class="n">domainUnit</span>
    
<div class="viewcode-block" id="energyInterval.setIndex"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.energyInterval.setIndex">[docs]</a>    <span class="k">def</span> <span class="nf">setIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span></div>
    
<div class="viewcode-block" id="energyInterval.toString"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.energyInterval.toString">[docs]</a>    <span class="k">def</span> <span class="nf">toString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simpleString</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> resonances, </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">. Contains </span><span class="si">%i</span><span class="s2"> resonances&quot;</span> <span class="o">%</span> 
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainMax</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span></div>
    
<div class="viewcode-block" id="energyInterval.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.energyInterval.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span> <span class="p">)</span>

        <span class="n">xmlString</span> <span class="o">=</span> <span class="p">[</span><span class="n">indent</span><span class="o">+</span>
                <span class="s1">&#39;&lt;region index=&quot;</span><span class="si">%s</span><span class="s1">&quot; domainMin=&quot;</span><span class="si">%r</span><span class="s1">&quot; domainMax=&quot;</span><span class="si">%r</span><span class="s1">&quot; domainUnit=&quot;</span><span class="si">%s</span><span class="s1">&quot; formalism=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span>
                <span class="o">%</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainMax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s2">&quot;Resonance section contains no data!&quot;</span> <span class="p">)</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/region&gt;&#39;</span>
        <span class="k">return</span> <span class="n">xmlString</span></div></div>


<span class="k">def</span> <span class="nf">_resonance_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">info</span><span class="p">,</span><span class="n">things</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Common resolved resonance checks</span>

<span class="sd">    :param self: a reference to the resonanceFormalismBaseClass (or derived) or RMatrix class</span>
<span class="sd">    :param info: the dictionary of checking options, shared by all .check() member functions.</span>
<span class="sd">                 For the potential scattering convergence test, the &#39;potentialScatteringCoverganceCriteria&#39;</span>
<span class="sd">                 value is the limit on the ratio of the Lth cross section term to the 0th one.  It is printed</span>
<span class="sd">                 as a percent but should be entered as a fraction.</span>
<span class="sd">    :param things: list of things to check the obvious way (with a .check() function)</span>
<span class="sd">    :return:</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">fudge.gnd</span> <span class="k">import</span> <span class="n">warning</span>
    <span class="n">warnings</span><span class="o">=</span><span class="p">[]</span>

    <span class="c1"># check the member data</span>
    <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">things</span><span class="p">:</span>
        <span class="n">warningList</span> <span class="o">=</span> <span class="n">thing</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">warningList</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span><span class="n">warningList</span><span class="p">))</span>

    <span class="c1"># now for the physics checks</span>
    <span class="kn">import</span> <span class="nn">fudge.processing.resonances.reconstructResonances</span> <span class="k">as</span> <span class="nn">rrReconstructModule</span>
    <span class="n">rrReconstructor</span> <span class="o">=</span> <span class="n">rrReconstructModule</span><span class="o">.</span><span class="n">getResonanceReconstructionClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">)(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;reactionSuite&#39;</span><span class="p">])</span>

    <span class="c1"># check for mismatched spins</span>
    <span class="n">warnings</span><span class="o">+=</span><span class="n">rrReconstructor</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span>\
        <span class="n">warnOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
        <span class="n">useReichMooreApproximation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="o">==</span><span class="n">RM</span><span class="o">.</span><span class="n">moniker</span><span class="p">)</span> <span class="c1">#multipleSScheme=&#39;NJOY&#39;, &#39;ENDF&#39; or None</span>

    <span class="c1"># check for missing channels via sum rule of statistical weights</span>
    <span class="n">sumgJ</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rrReconstructor</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sumgJ</span><span class="p">:</span> <span class="n">sumgJ</span><span class="p">[(</span><span class="n">c</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">)]</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">sumgJ</span><span class="p">[(</span><span class="n">c</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">)]</span><span class="o">+=</span><span class="n">c</span><span class="o">.</span><span class="n">gfact</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">sumgJ</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">rxn</span><span class="p">,</span><span class="n">L</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sumgJ</span><span class="p">[(</span><span class="n">rxn</span><span class="p">,</span><span class="n">L</span><span class="p">)])</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">L</span><span class="o">+</span><span class="mf">1.0</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">6</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">badSpinStatisticalWeights</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">sumgJ</span><span class="p">[(</span><span class="n">rxn</span><span class="p">,</span><span class="n">L</span><span class="p">)],</span><span class="mf">2.</span><span class="o">*</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">rxn</span><span class="p">))</span>

    <span class="c1"># check for missing channels by looping through all the allowed angular momenta</span>
    <span class="k">def</span> <span class="nf">getSList</span><span class="p">(</span><span class="n">Ia</span><span class="p">,</span><span class="n">Ib</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get possible spins&#39;&#39;&#39;</span>
        <span class="n">smin</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">Ia</span><span class="o">-</span><span class="n">Ib</span><span class="p">)</span>
        <span class="n">smax</span><span class="o">=</span><span class="n">Ia</span><span class="o">+</span><span class="n">Ib</span>
        <span class="n">nS</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">smax</span><span class="o">-</span><span class="n">smin</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">iS</span><span class="o">+</span><span class="n">smin</span> <span class="k">for</span> <span class="n">iS</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nS</span><span class="p">)]</span>
    <span class="n">LMax</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">allSs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rxnList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rrReconstructor</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">eliminated</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">LMax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span><span class="n">LMax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">reaction</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rxnList</span><span class="p">:</span> <span class="n">rxnList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reaction</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">channelClass</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">rrReconstructModule</span><span class="o">.</span><span class="n">FISSIONCHANNEL</span><span class="p">,</span><span class="n">rrReconstructModule</span><span class="o">.</span><span class="n">COMPETATIVECHANNEL</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">getSList</span><span class="p">(</span><span class="o">*</span><span class="n">rrReconstructor</span><span class="o">.</span><span class="n">getParticleSpins</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reaction</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allSs</span><span class="p">:</span> <span class="n">allSs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">LMax</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Jmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">allSs</span><span class="p">)</span>
        <span class="n">Jmax</span><span class="o">=</span><span class="n">LMax</span><span class="o">+</span><span class="nb">max</span><span class="p">(</span><span class="n">allSs</span><span class="p">)</span>
        <span class="n">nJ</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">Jmax</span><span class="o">-</span><span class="n">Jmin</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iJ</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nJ</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">J</span><span class="o">=</span><span class="n">iJ</span><span class="o">+</span><span class="n">Jmin</span>
            <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">rxnList</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;ission&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rxn</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">S</span> <span class="ow">in</span> <span class="n">getSList</span><span class="p">(</span><span class="o">*</span><span class="n">rrReconstructor</span><span class="o">.</span><span class="n">getParticleSpins</span><span class="p">(</span><span class="n">rxn</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">J</span> <span class="ow">in</span> <span class="n">rrReconstructModule</span><span class="o">.</span><span class="n">getAllowedTotalSpins</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">useFactor2Trick</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> <span class="k">continue</span>
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rrReconstructor</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
                            <span class="n">gotIt</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">if</span> <span class="n">rxn</span><span class="o">==</span><span class="n">c</span><span class="o">.</span><span class="n">reaction</span> <span class="ow">and</span> \
                                    <span class="n">rrReconstructModule</span><span class="o">.</span><span class="n">spins_equal</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span><span class="n">L</span><span class="p">)</span> <span class="ow">and</span> \
                                    <span class="n">rrReconstructModule</span><span class="o">.</span><span class="n">spins_equal</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">J</span><span class="p">,</span><span class="n">J</span><span class="p">)</span> <span class="ow">and</span> \
                                    <span class="n">rrReconstructModule</span><span class="o">.</span><span class="n">spins_equal</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">s</span><span class="p">,</span><span class="n">S</span><span class="p">):</span>
                                <span class="n">gotIt</span><span class="o">=</span><span class="kc">True</span>
                                <span class="k">break</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">gotIt</span><span class="p">:</span>
                            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">missingResonanceChannel</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">rxn</span><span class="p">))</span>

    <span class="c1"># check for convergence in L</span>
    <span class="kn">import</span> <span class="nn">numpy</span>
    <span class="n">almostXS</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rrReconstructor</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">rrReconstructor</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">,</span> <span class="n">rrReconstructor</span><span class="o">.</span><span class="n">lowerBound</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="n">Xi</span><span class="p">),</span> <span class="n">rrReconstructor</span><span class="o">.</span><span class="n">upperBound</span><span class="p">])</span>
        <span class="n">phis</span><span class="o">=</span><span class="n">rrReconstructor</span><span class="o">.</span><span class="n">phiByChannel</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">egrid</span><span class="p">)</span>
        <span class="n">almostXS</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,[])</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phis</span><span class="p">)</span><span class="o">/</span><span class="n">rrReconstructor</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">egrid</span><span class="p">),</span><span class="mf">2.0</span><span class="p">))</span> <span class="p">)</span>
    <span class="n">fom</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">almostXS</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">almostXS</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">almostXS</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">almostXS</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span>
    <span class="n">fomTarget</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;potentialScatteringCoverganceCriteria&#39;</span><span class="p">,</span><span class="mf">0.001</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fom</span> <span class="o">&gt;</span> <span class="n">fomTarget</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">potentialScatteringNotConverged</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">rrReconstructor</span><span class="o">.</span><span class="n">upperBound</span><span class="p">,</span> <span class="n">fom</span><span class="p">,</span> <span class="n">fomTarget</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">warnings</span>


<span class="c1">################################################################</span>
<span class="c1"># now we come to specific implementations for resolved region: #</span>
<span class="c1">################################################################</span>
<div class="viewcode-block" id="resonanceFormalismBaseClass"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceFormalismBaseClass">[docs]</a><span class="k">class</span> <span class="nc">resonanceFormalismBaseClass</span><span class="p">(</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">optAttrList</span> <span class="o">=</span> <span class="p">(</span> <span class="s1">&#39;calculateChannelRadius&#39;</span><span class="p">,</span> <span class="s1">&#39;computeAngularDistribution&#39;</span><span class="p">,</span> <span class="s1">&#39;LvaluesNeededForConvergence&#39;</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resonanceParameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scatteringRadius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;LdependentScatteringRadii is a list of dictionaries, one for each L with APL != AP</span>
<span class="sd">        only used in ENDF for Reich_Moore form</span>
<span class="sd">        </span>
<span class="sd">        resonanceParameters should be a gnd.core.math.table.table instance.&quot;&quot;&quot;</span>

        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optAttrList</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeAngularDistribution</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">computeAngularDistribution</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">computeAngularDistribution</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span> <span class="o">=</span> <span class="n">resonanceParameters</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span> <span class="o">=</span> <span class="n">scatteringRadius</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

<div class="viewcode-block" id="resonanceFormalismBaseClass.check"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceFormalismBaseClass.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">info</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">_resonance_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
    
<div class="viewcode-block" id="resonanceFormalismBaseClass.addResonance"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceFormalismBaseClass.addResonance">[docs]</a>    <span class="k">def</span> <span class="nf">addResonance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resonance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; insert a new resonance in the resonance parameter table &quot;&quot;&quot;</span>
        <span class="c1">#resonance = (energy, J, l, ... )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span> <span class="n">resonance</span> <span class="p">)</span></div>

<div class="viewcode-block" id="resonanceFormalismBaseClass.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceFormalismBaseClass.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>

        <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span> <span class="p">)</span>
        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span> <span class="p">(</span><span class="s2">&quot;Please use specific formalisms (MLBW, RM, etc) instead of the BaseClass&quot;</span><span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optAttrList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">,</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">attrVal</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">attrVal</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span> <span class="n">attrVal</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">attrVal</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">xmlString</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1">=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">attrVal</span> <span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmlString</span><span class="o">+</span><span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="p">:</span>
            <span class="n">xmlString</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span>
        <span class="k">return</span> <span class="n">xmlString</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="resonanceFormalismBaseClass.parseXMLNode"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceFormalismBaseClass.parseXMLNode">[docs]</a>    <span class="k">def</span> <span class="nf">parseXMLNode</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">):</span>

        <span class="n">xPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">scatteringRadius</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;scatteringRadius&#39;</span><span class="p">),</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
        <span class="n">linkData</span><span class="p">[</span><span class="s1">&#39;conversionTable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">}</span>    <span class="c1"># inform table class how to treat columns</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">resonanceParameters</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="n">resonanceParameters</span><span class="o">.</span><span class="n">moniker</span> <span class="p">),</span>
                <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">getAttrs</span><span class="p">(</span> <span class="n">element</span> <span class="p">)</span>
        <span class="n">resonanceData</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span> <span class="p">)</span>
        <span class="k">del</span> <span class="n">linkData</span><span class="p">[</span><span class="s1">&#39;conversionTable&#39;</span><span class="p">]</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">resonanceData</span></div></div>
    
<div class="viewcode-block" id="SLBW"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.SLBW">[docs]</a><span class="k">class</span> <span class="nc">SLBW</span><span class="p">(</span> <span class="n">resonanceFormalismBaseClass</span> <span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Resonance region in Single-Level Breit-Wigner form.&quot;&quot;&quot;</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;SingleLevel_BreitWigner&#39;</span>

<div class="viewcode-block" id="SLBW.check"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.SLBW.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">info</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Common resolved resonance checks</span>

<span class="sd">        :param self: a reference to the resonanceFormalismBaseClass (or derived) or RMatrix class</span>
<span class="sd">        :param info: the dictionary of checking options, shared by all .check() member functions.</span>
<span class="sd">                     For the potential scattering convergence test, the &#39;potentialScatteringCoverganceCriteria&#39;</span>
<span class="sd">                     value is the limit on the ratio of the Lth cross section term to the 0th one.  It is printed</span>
<span class="sd">                     as a percent but should be entered as a fraction.</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">fudge.gnd</span> <span class="k">import</span> <span class="n">warning</span>
        <span class="n">warnings</span><span class="o">=</span><span class="p">[]</span>

        <span class="c1"># check the member data</span>
        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span>  <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="p">]:</span>
            <span class="n">warningList</span> <span class="o">=</span> <span class="n">thing</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">warningList</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span><span class="n">warningList</span><span class="p">))</span>
        <span class="kn">from</span> <span class="nn">fudge.gnd</span> <span class="k">import</span> <span class="n">warning</span>
        <span class="n">warnings</span><span class="o">=</span><span class="p">[]</span>

        <span class="c1"># now for the physics checks</span>
        <span class="kn">import</span> <span class="nn">fudge.processing.resonances.reconstructResonances</span> <span class="k">as</span> <span class="nn">rrReconstructModule</span>
        <span class="n">rrReconstructor</span> <span class="o">=</span> <span class="n">rrReconstructModule</span><span class="o">.</span><span class="n">getResonanceReconstructionClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">)(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;reactionSuite&#39;</span><span class="p">])</span>
        <span class="n">warnings</span><span class="o">+=</span><span class="n">rrReconstructor</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span><span class="n">warnOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#multipleSScheme=&#39;NJOY&#39;, &#39;ENDF&#39; or None</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">channels</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rrReconstructor</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
            <span class="c1"># check for missing channels</span>
            <span class="n">sumgJ</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">isElastic</span><span class="p">:</span> <span class="k">continue</span>
                <span class="c1">#FIXME: mixing gamma, neutron and fission channels!!!!</span>
                <span class="c1">#FIXME: I think gJ should use particle pair spins, not neutron+target!!!!</span>
                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sumgJ</span><span class="p">:</span> <span class="n">sumgJ</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">sumgJ</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">]</span><span class="o">+=</span><span class="n">c</span><span class="o">.</span><span class="n">gfact</span>
            <span class="n">Ls</span> <span class="o">=</span> <span class="n">sumgJ</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">Ls</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">Ls</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sumgJ</span><span class="p">[</span><span class="n">L</span><span class="p">])</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">L</span><span class="o">+</span><span class="mf">1.0</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">6</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">badSpinStatisticalWeights</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">sumgJ</span><span class="p">[</span><span class="n">L</span><span class="p">],</span><span class="mf">2.</span><span class="o">*</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

            <span class="c1"># check for convergence in L</span>
            <span class="kn">import</span> <span class="nn">numpy</span>
            <span class="n">almostXS</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">almostXS</span><span class="p">:</span>
                    <span class="n">egrid</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rrReconstructor</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">,</span> <span class="n">rrReconstructor</span><span class="o">.</span><span class="n">upperBound</span><span class="p">])</span>
                    <span class="n">phis</span><span class="o">=</span><span class="n">rrReconstructor</span><span class="o">.</span><span class="n">phiByChannel</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">egrid</span><span class="p">)</span>
                    <span class="n">almostXS</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">]</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phis</span><span class="p">)</span><span class="o">/</span><span class="n">rrReconstructor</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">egrid</span><span class="p">),</span><span class="mf">2.0</span><span class="p">)</span>
            <span class="n">fom</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">almostXS</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">almostXS</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">almostXS</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">almostXS</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span>
            <span class="n">fomTarget</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;potentialScatteringCoverganceCriteria&#39;</span><span class="p">,</span><span class="mf">0.001</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fom</span> <span class="o">&gt;</span> <span class="n">fomTarget</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">potentialScatteringNotConverged</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">rrReconstructor</span><span class="o">.</span><span class="n">upperBound</span><span class="p">,</span> <span class="n">fom</span><span class="p">,</span> <span class="n">fomTarget</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">warnings</span></div></div>

<div class="viewcode-block" id="MLBW"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.MLBW">[docs]</a><span class="k">class</span> <span class="nc">MLBW</span><span class="p">(</span> <span class="n">resonanceFormalismBaseClass</span> <span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Resonance region in Multi-Level Breit-Wigner form.&quot;&quot;&quot;</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;MultiLevel_BreitWigner&#39;</span></div>

<div class="viewcode-block" id="RM"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.RM">[docs]</a><span class="k">class</span> <span class="nc">RM</span><span class="p">(</span> <span class="n">resonanceFormalismBaseClass</span> <span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Reich_Moore formalism.&quot;&quot;&quot;</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;Reich_Moore&#39;</span></div>

<span class="c1">#############################################</span>
<span class="c1"># R-matrix (LRF=7 in ENDF) is more complex: #</span>
<span class="c1">#############################################</span>
<div class="viewcode-block" id="RMatrix"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.RMatrix">[docs]</a><span class="k">class</span> <span class="nc">RMatrix</span><span class="p">(</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    RMatrix is a general container for resolved resonance parameters.</span>
<span class="sd">    It can handle standard Lane &amp; Thomas R-Matrix, but can also use various approximations</span>
<span class="sd">    (Single- and Multi-level Breit Wigner plus Reich-Moore).</span>
<span class="sd">    </span>
<span class="sd">    Internally, resonances are sorted into spin groups, each with a conserved total angular momentum and parity.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;RMatrix&#39;</span>

    <span class="n">optAttrList</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;approximation&#39;</span><span class="p">,</span><span class="s1">&#39;boundaryCondition&#39;</span><span class="p">,</span><span class="s1">&#39;relativisticKinematics&#39;</span><span class="p">,</span><span class="s1">&#39;reconstructAngular&#39;</span><span class="p">,</span>
            <span class="s1">&#39;reducedWidthAmplitudes&#39;</span><span class="p">,</span><span class="s1">&#39;calculatePenetrability&#39;</span><span class="p">,</span><span class="s1">&#39;calculateShift&#39;</span><span class="p">,</span><span class="s1">&#39;calculateChannelRadius&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ENDFconversionFlag&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resonanceReactions</span><span class="p">,</span> <span class="n">spinGroups</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resonanceReactions</span> <span class="o">=</span> <span class="n">resonanceReactions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinGroups</span> <span class="o">=</span> <span class="n">spinGroups</span>
        <span class="k">for</span> <span class="n">sg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spinGroups</span><span class="p">:</span> <span class="n">sg</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optAttrList</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spinGroups</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinGroups</span><span class="p">)</span>

<div class="viewcode-block" id="RMatrix.check"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.RMatrix.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">info</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">_resonance_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">spinGroups</span><span class="p">)</span></div>

<div class="viewcode-block" id="RMatrix.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.RMatrix.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;  &#39;</span>
        <span class="n">xmlString</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optAttrList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">):</span>
                <span class="n">attrVal</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">attrVal</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span> <span class="n">attrVal</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">attrVal</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">xmlString</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1">=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span><span class="n">attrVal</span><span class="p">)</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&gt;&#39;</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">gr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spinGroups</span><span class="p">:</span>
            <span class="n">xmlString</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">gr</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span>
        <span class="k">return</span> <span class="n">xmlString</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="RMatrix.parseXMLNode"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.RMatrix.parseXMLNode">[docs]</a>    <span class="k">def</span> <span class="nf">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">):</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>
        <span class="n">RRs</span> <span class="o">=</span> <span class="n">resonanceReactions</span><span class="p">()</span>
        <span class="n">RRs</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">resonanceReactions</span><span class="o">.</span><span class="n">moniker</span><span class="p">),</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">)</span>
        <span class="n">spinGroups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">linkData</span><span class="p">[</span><span class="s1">&#39;conversionTable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;channelSpin&#39;</span><span class="p">:</span><span class="n">spin</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">sg</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">element</span> <span class="k">if</span> <span class="n">ch</span><span class="o">.</span><span class="n">tag</span><span class="o">==</span><span class="s1">&#39;spinGroup&#39;</span><span class="p">]:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">resonanceParameters</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">sg</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">resonanceParameters</span><span class="o">.</span><span class="n">moniker</span><span class="p">),</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
            <span class="n">chs</span> <span class="o">=</span> <span class="n">channels</span><span class="p">()</span>
            <span class="n">chs</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">sg</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">channels</span><span class="o">.</span><span class="n">moniker</span><span class="p">),</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
            <span class="n">spinGroups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">spinGroup</span><span class="p">(</span> <span class="n">channels</span><span class="o">=</span><span class="n">chs</span><span class="p">,</span> <span class="n">resonanceParameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="o">**</span><span class="n">getAttrs</span><span class="p">(</span><span class="n">sg</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;background&#39;</span><span class="p">,)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">RMatrix</span><span class="p">(</span> <span class="n">RRs</span><span class="p">,</span> <span class="n">spinGroups</span><span class="p">,</span> <span class="o">**</span><span class="n">getAttrs</span><span class="p">(</span><span class="n">element</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="n">RMatrix</span><span class="o">.</span><span class="n">optAttrList</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">del</span> <span class="n">linkData</span><span class="p">[</span><span class="s1">&#39;conversionTable&#39;</span><span class="p">]</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tmp</span></div></div>

<div class="viewcode-block" id="resonanceReactions"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceReactions">[docs]</a><span class="k">class</span> <span class="nc">resonanceReactions</span><span class="p">(</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">suite</span> <span class="p">):</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;resonanceReactions&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">suitesModule</span><span class="o">.</span><span class="n">suite</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">resonanceReaction</span><span class="p">])</span>

<div class="viewcode-block" id="resonanceReactions.check"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceReactions.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">info</span> <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">fudge.gnd</span> <span class="k">import</span> <span class="n">warning</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">warningList</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">warningList</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">moniker</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">label</span><span class="p">),</span><span class="n">warningList</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">warnings</span></div></div>

<div class="viewcode-block" id="resonanceReaction"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceReaction">[docs]</a><span class="k">class</span> <span class="nc">resonanceReaction</span><span class="p">(</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Describes one reaction channel that opens up in the resonance region. In an R-Matrix section,</span>
<span class="sd">    all open reaction channels should be described in the list of resonanceReaction elements</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;resonanceReaction&#39;</span>

    <span class="n">fission</span> <span class="o">=</span> <span class="s1">&#39;fission&#39;</span>                 <span class="c1"># special tokens to support fission reactions</span>
    <span class="n">fissionProduct</span> <span class="o">=</span> <span class="s1">&#39;fissionProduct&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">reactionLink</span><span class="p">,</span> <span class="n">ejectile</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scatteringRadius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hardSphereRadius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">computeShiftFactor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reactionLink</span> <span class="o">=</span> <span class="n">reactionLink</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ejectile</span> <span class="o">=</span> <span class="n">ejectile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__residual</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span> <span class="o">=</span> <span class="n">scatteringRadius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hardSphereRadius</span> <span class="o">=</span> <span class="n">hardSphereRadius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">computeShiftFactor</span> <span class="o">=</span> <span class="n">computeShiftFactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eliminated</span> <span class="o">=</span> <span class="n">eliminated</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ejectile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ejectile</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">residual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__residual</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ejectile</span> <span class="o">==</span> <span class="n">resonanceReaction</span><span class="o">.</span><span class="n">fission</span><span class="p">:</span> <span class="k">return</span> <span class="n">resonanceReaction</span><span class="o">.</span><span class="n">fissionProduct</span>

            <span class="n">products</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactionLink</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">products</span><span class="p">])</span>
            <span class="n">products</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">ejectile</span> <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">products</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot compute resonanceReaction residual!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__residual</span> <span class="o">=</span> <span class="n">products</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__residual</span>

<div class="viewcode-block" id="resonanceReaction.check"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceReaction.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">info</span> <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">fudge.gnd</span> <span class="k">import</span> <span class="n">warning</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># check the reaction link</span>
        <span class="n">theLinkTarget</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">theLinkTarget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactionLink</span><span class="o">.</span><span class="n">follow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getRootAncestor</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">theLinkTarget</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">unresolvedLink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactionLink</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">unresolvedLink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactionLink</span><span class="p">))</span>

        <span class="c1"># check the radii</span>
        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardSphereRadius</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">thing</span> <span class="ow">is</span>  <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">warningList</span> <span class="o">=</span> <span class="n">thing</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">warningList</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span><span class="n">warningList</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">warnings</span></div>

<div class="viewcode-block" id="resonanceReaction.isFission"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceReaction.isFission">[docs]</a>    <span class="k">def</span> <span class="nf">isFission</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactionLink</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">isFission</span><span class="p">()</span></div>

<div class="viewcode-block" id="resonanceReaction.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceReaction.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span><span class="o">+</span><span class="s1">&#39;  &#39;</span>
        <span class="n">attrstring</span> <span class="o">=</span> <span class="s1">&#39; computeShiftFactor=&quot;true&quot;&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeShiftFactor</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eliminated</span><span class="p">:</span> <span class="n">attrstring</span> <span class="o">+=</span> <span class="s1">&#39; eliminated=&quot;true&quot;&#39;</span>
        <span class="n">xmlString</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1"> label=&quot;</span><span class="si">%s</span><span class="s1">&quot; ejectile=&quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ejectile</span><span class="p">,</span> <span class="n">attrstring</span><span class="p">)</span> <span class="p">]</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactionLink</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardSphereRadius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardSphereRadius</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span>
        <span class="k">return</span> <span class="n">xmlString</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="resonanceReaction.parseXMLNode"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.resonanceReaction.parseXMLNode">[docs]</a>    <span class="k">def</span> <span class="nf">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">):</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>
        <span class="n">reactionLink</span> <span class="o">=</span> <span class="n">linkModule</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">),</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
        <span class="n">Qval</span><span class="p">,</span> <span class="n">scatRad</span><span class="p">,</span> <span class="n">hsRad</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="n">Q</span><span class="o">.</span><span class="n">moniker</span> <span class="p">):</span>
            <span class="n">Qval</span> <span class="o">=</span> <span class="n">Q</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="n">Q</span><span class="o">.</span><span class="n">moniker</span> <span class="p">),</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="n">scatteringRadius</span><span class="o">.</span><span class="n">moniker</span> <span class="p">):</span>
            <span class="n">scatRad</span> <span class="o">=</span> <span class="n">scatteringRadius</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="n">scatteringRadius</span><span class="o">.</span><span class="n">moniker</span> <span class="p">),</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="n">hardSphereRadius</span><span class="o">.</span><span class="n">moniker</span> <span class="p">):</span>
            <span class="n">hsRad</span> <span class="o">=</span> <span class="n">hardSphereRadius</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="n">hardSphereRadius</span><span class="o">.</span><span class="n">moniker</span><span class="p">),</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">resonanceReaction</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">),</span> <span class="n">reactionLink</span><span class="o">=</span><span class="n">reactionLink</span><span class="p">,</span> <span class="n">ejectile</span><span class="o">=</span><span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ejectile&#39;</span><span class="p">),</span>
                <span class="n">Q</span> <span class="o">=</span> <span class="n">Qval</span><span class="p">,</span> <span class="n">scatteringRadius</span><span class="o">=</span><span class="n">scatRad</span><span class="p">,</span> <span class="n">hardSphereRadius</span><span class="o">=</span><span class="n">hsRad</span><span class="p">,</span>
                <span class="n">computeShiftFactor</span><span class="o">=</span><span class="n">getBool</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;computeShiftFactor&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">)</span> <span class="p">),</span>
                <span class="n">eliminated</span><span class="o">=</span><span class="n">getBool</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;eliminated&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tmp</span></div></div>

<div class="viewcode-block" id="channels"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.channels">[docs]</a><span class="k">class</span> <span class="nc">channels</span><span class="p">(</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">suite</span> <span class="p">):</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;channels&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">suitesModule</span><span class="o">.</span><span class="n">suite</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">channel</span><span class="p">])</span></div>

<div class="viewcode-block" id="channel"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.channel">[docs]</a><span class="k">class</span> <span class="nc">channel</span><span class="p">(</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use if necessary to override the true scattering radius, effective radius, etc. for a single</span>
<span class="sd">    spin-group / channel combination.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;channel&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">resonanceReaction</span><span class="p">,</span> <span class="n">columnIndex</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">channelSpin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">scatteringRadius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hardSphereRadius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">penetrability</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">shiftFactor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phaseShift</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">boundaryConditionOverride</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resonanceReaction</span> <span class="o">=</span> <span class="n">resonanceReaction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columnIndex</span> <span class="o">=</span> <span class="n">columnIndex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channelSpin</span> <span class="o">=</span> <span class="n">channelSpin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span> <span class="o">=</span> <span class="n">scatteringRadius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hardSphereRadius</span> <span class="o">=</span> <span class="n">hardSphereRadius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">penetrability</span> <span class="o">=</span> <span class="n">penetrability</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shiftFactor</span> <span class="o">=</span> <span class="n">shiftFactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phaseShift</span> <span class="o">=</span> <span class="n">phaseShift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundaryConditionOverride</span> <span class="o">=</span> <span class="n">boundaryConditionOverride</span>

<div class="viewcode-block" id="channel.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.channel.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span><span class="o">+</span><span class="s1">&#39;  &#39;</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">attrs</span> <span class="o">+=</span> <span class="s1">&#39; L=&quot;</span><span class="si">%d</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channelSpin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">attrs</span> <span class="o">+=</span> <span class="s1">&#39; channelSpin=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">channelSpin</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryConditionOverride</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">+=</span> <span class="s1">&#39; boundaryConditionOverride=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryConditionOverride</span>
        <span class="n">xmlString</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1"> label=&quot;</span><span class="si">%s</span><span class="s1">&quot; resonanceReaction=&quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="si">%s</span><span class="s1"> columnIndex=&quot;</span><span class="si">%d</span><span class="s1">&quot;&gt;&#39;</span> <span class="o">%</span>
                     <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonanceReaction</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnIndex</span><span class="p">)</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;scatteringRadius&#39;</span><span class="p">,</span> <span class="s1">&#39;hardSphereRadius&#39;</span><span class="p">,</span> <span class="s1">&#39;penetrability&#39;</span><span class="p">,</span> <span class="s1">&#39;shiftFactor&#39;</span><span class="p">,</span> <span class="s1">&#39;phaseShift&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xmlString</span> <span class="o">+=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span>
        <span class="k">return</span> <span class="n">xmlString</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="channel.parseXMLNode"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.channel.parseXMLNode">[docs]</a>    <span class="k">def</span> <span class="nf">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">):</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">getAttrs</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">element</span><span class="p">:</span>
            <span class="n">childClass</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;scatteringRadius&#39;</span><span class="p">:</span> <span class="n">scatteringRadius</span><span class="p">,</span>
                          <span class="s1">&#39;hardSphereRadius&#39;</span><span class="p">:</span> <span class="n">hardSphereRadius</span><span class="p">,</span>
                          <span class="s1">&#39;penetrability&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>    <span class="c1"># FIXME last three not yet implemented</span>
                          <span class="s1">&#39;shiftFactor&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="s1">&#39;phaseShift&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="p">]</span> <span class="o">=</span> <span class="n">childClass</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tmp</span></div></div>

<div class="viewcode-block" id="spinGroup"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.spinGroup">[docs]</a><span class="k">class</span> <span class="nc">spinGroup</span><span class="p">(</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Single group with same Jpi (conserved). Each spin group contains an AP (scattering radius),</span>
<span class="sd">    along with 1 or more resonance widths.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;spinGroup&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">spin</span><span class="p">,</span> <span class="n">parity</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">resonanceParameters</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">applyPhaseShift</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="n">spin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parity</span> <span class="o">=</span> <span class="n">parity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels</span> <span class="o">=</span> <span class="n">channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span> <span class="o">=</span> <span class="n">resonanceParameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">background</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applyPhaseShift</span> <span class="o">=</span> <span class="n">applyPhaseShift</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># for sorting spin groups by Jpi. group J values together</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parity</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">spin</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">parity</span><span class="p">)</span>

<div class="viewcode-block" id="spinGroup.check"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.spinGroup.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">info</span> <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">fudge.gnd</span> <span class="k">import</span> <span class="n">warning</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="n">thing</span> <span class="ow">is</span>  <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">warningList</span> <span class="o">=</span> <span class="n">thing</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">warningList</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span><span class="n">warningList</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">warnings</span></div>

<div class="viewcode-block" id="spinGroup.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.spinGroup.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span> <span class="p">)</span>
        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span>

        <span class="n">xmlString</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1"> index=&quot;</span><span class="si">%i</span><span class="s1">&quot; spin=&quot;</span><span class="si">%s</span><span class="s1">&quot; parity=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parity</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="s1">&#39;background&#39;</span><span class="p">,</span><span class="s1">&#39;applyPhaseShift&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
                <span class="n">attrVal</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">opt</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">attrVal</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span> <span class="n">attrVal</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">attrVal</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">xmlString</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1">=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">attrVal</span><span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmlString</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>    <span class="c1"># need not contain any data</span>
            <span class="n">xmlString</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xmlString</span><span class="p">)</span></div></div>

<span class="c1">#############################################</span>
<span class="c1">#    end of R-Matrix (LRF=7) classes        #</span>
<span class="c1">#############################################</span>


<span class="c1">####################################################</span>
<span class="c1"># remaining classes are for unresolved resonances: #</span>
<span class="c1">####################################################</span>
<div class="viewcode-block" id="unresolvedTabulatedWidths"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.unresolvedTabulatedWidths">[docs]</a><span class="k">class</span> <span class="nc">unresolvedTabulatedWidths</span><span class="p">:</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;tabulatedWidths&#39;</span>
    <span class="n">optAttrList</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;interpolation&#39;</span><span class="p">,</span><span class="s1">&#39;ENDFconversionFlag&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scatteringRadius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; L_values is a list of URR_Lsections, which in turn contains a list of J_sections. </span>
<span class="sd">        The average widths are given in the J_sections &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optAttrList</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_values</span> <span class="o">=</span> <span class="n">L_values</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span> <span class="o">=</span> <span class="n">scatteringRadius</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L_values</span><span class="p">)</span>
    
<div class="viewcode-block" id="unresolvedTabulatedWidths.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.unresolvedTabulatedWidths.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span> <span class="p">)</span>

        <span class="n">xmlString</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optAttrList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">,</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">attrVal</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">attrVal</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span> <span class="n">attrVal</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">attrVal</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">xmlString</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1">=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">attrVal</span><span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmlString</span><span class="o">+</span><span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_values</span><span class="p">:</span>
            <span class="n">xmlString</span> <span class="o">+=</span> <span class="n">L</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span>
        <span class="k">return</span> <span class="n">xmlString</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="unresolvedTabulatedWidths.parseXMLNode"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.unresolvedTabulatedWidths.parseXMLNode">[docs]</a>    <span class="k">def</span> <span class="nf">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">):</span>

        <span class="n">xPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>
        <span class="n">L_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scatRadius</span> <span class="o">=</span> <span class="n">scatteringRadius</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;scatteringRadius&#39;</span><span class="p">),</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
        <span class="n">linkData</span><span class="p">[</span><span class="s1">&#39;conversionTable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">lval</span> <span class="ow">in</span> <span class="n">element</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lval</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">URR_Lsection</span><span class="o">.</span><span class="n">moniker</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">J_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">jval</span> <span class="ow">in</span> <span class="n">lval</span><span class="p">:</span>
                <span class="n">consWid</span><span class="p">,</span> <span class="n">edepWid</span> <span class="o">=</span> <span class="p">{},</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">width</span> <span class="ow">in</span> <span class="n">jval</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">width</span><span class="o">.</span><span class="n">tag</span><span class="o">==</span><span class="s1">&#39;constantWidths&#39;</span><span class="p">:</span>
                        <span class="n">consWid</span> <span class="o">=</span> <span class="n">getAttrs</span><span class="p">(</span> <span class="n">width</span> <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">edepWid</span> <span class="o">=</span> <span class="n">tableModule</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">width</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">edepWid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">edepWid</span> <span class="o">=</span> <span class="n">tableModule</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">quant</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span><span class="s1">&#39;levelSpacing&#39;</span><span class="p">,</span><span class="s1">&#39;neutronWidth&#39;</span><span class="p">,</span><span class="s1">&#39;captureWidth&#39;</span><span class="p">,</span><span class="s1">&#39;fissionWidthA&#39;</span><span class="p">,</span><span class="s1">&#39;competitiveWidth&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span> <span class="n">quant</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">consWid</span> <span class="ow">and</span> <span class="n">quant</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edepWid</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="p">):</span>
                        <span class="n">consWid</span><span class="p">[</span><span class="n">quant</span><span class="p">]</span> <span class="o">=</span> <span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
                <span class="n">J_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">URR_Jsection</span><span class="p">(</span> <span class="n">spin</span><span class="p">(</span><span class="n">jval</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">)),</span> <span class="n">edepWid</span><span class="p">,</span> <span class="n">consWid</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">getAttrs</span><span class="p">(</span> <span class="n">jval</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;neutronDOF&quot;</span><span class="p">,</span><span class="s2">&quot;gammaDOF&quot;</span><span class="p">,</span><span class="s2">&quot;fissionDOF&quot;</span><span class="p">,</span><span class="s2">&quot;competitiveDOF&quot;</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">L_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">URR_Lsection</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">lval</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)),</span> <span class="n">J_values</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">unresolvedTabulatedWidths</span><span class="p">(</span> <span class="n">L_values</span><span class="p">,</span> <span class="n">scatRadius</span><span class="p">,</span> <span class="o">**</span><span class="n">getAttrs</span><span class="p">(</span> <span class="n">element</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">del</span> <span class="n">linkData</span><span class="p">[</span><span class="s1">&#39;conversionTable&#39;</span><span class="p">]</span>
        <span class="n">xPath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">table</span></div></div>

    
<span class="c1"># each of the above sections contains one or more &#39;L&#39; sections, which each contain one or more &#39;J&#39;s:</span>
<div class="viewcode-block" id="URR_Lsection"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.URR_Lsection">[docs]</a><span class="k">class</span> <span class="nc">URR_Lsection</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; unresolved average widths, grouped by L. Contains list of J-values: &quot;&quot;&quot;</span>
    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;L_section&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">J_values</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J_values</span> <span class="o">=</span> <span class="n">J_values</span>
    
<div class="viewcode-block" id="URR_Lsection.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.URR_Lsection.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span> <span class="p">)</span>

        <span class="n">xmlString</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1"> L=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_values</span><span class="p">:</span>
            <span class="n">xmlString</span> <span class="o">+=</span> <span class="n">J</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span>
        <span class="k">return</span> <span class="n">xmlString</span></div></div>


<div class="viewcode-block" id="URR_Jsection"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.URR_Jsection">[docs]</a><span class="k">class</span> <span class="nc">URR_Jsection</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; unresolved average widths, grouped by J. Should contain *either*</span>
<span class="sd">     - energyDependentWidths, with a table of widths / level densities as function of energy, or</span>
<span class="sd">     - constantWidths + energyGrid (the grid is necessary to tell where to do the reconstruction) &quot;&quot;&quot;</span>
    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;J_section&#39;</span>
    <span class="n">optAttrList</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;competitiveDOF&#39;</span><span class="p">,</span><span class="s1">&#39;neutronDOF&#39;</span><span class="p">,</span><span class="s1">&#39;gammaDOF&#39;</span><span class="p">,</span><span class="s1">&#39;fissionDOF&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">energyDependentWidths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">constantWidths</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J</span> <span class="o">=</span> <span class="n">J</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optAttrList</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constantWidths</span> <span class="o">=</span> <span class="n">constantWidthSection</span><span class="p">(</span> <span class="o">**</span><span class="n">constantWidths</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energyDependentWidths</span> <span class="o">=</span> <span class="n">energyDependentWidths</span>
    
<div class="viewcode-block" id="URR_Jsection.eliminateRedundantInfo"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.URR_Jsection.eliminateRedundantInfo">[docs]</a>    <span class="k">def</span> <span class="nf">eliminateRedundantInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; ENDF often lists more info than necessary. </span>
<span class="sd">        If we encounter section where everything (except energy) is constant, </span>
<span class="sd">        move data from &#39;energyDependentWidths&#39; to &#39;constantWidths&#39; &quot;&quot;&quot;</span>

        <span class="n">allEliminated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">edep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energyDependentWidths</span>
        <span class="k">for</span> <span class="n">colId</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">edep</span><span class="o">.</span><span class="n">nColumns</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">column</span> <span class="o">=</span> <span class="n">edep</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">colId</span><span class="p">]</span>
            <span class="n">columnData</span> <span class="o">=</span> <span class="n">edep</span><span class="o">.</span><span class="n">getColumn</span><span class="p">(</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span> <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span> <span class="n">columnData</span> <span class="p">)</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">constantWidths</span><span class="p">,</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span> <span class="n">PQU</span><span class="o">.</span><span class="n">pqu_float</span><span class="o">.</span><span class="n">surmiseSignificantDigits</span><span class="p">(</span> <span class="n">columnData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">),</span> <span class="n">column</span><span class="o">.</span><span class="n">unit</span> <span class="p">)</span> <span class="p">)</span>
                <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">colId</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">edep</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
                <span class="n">edep</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">colId</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">edep</span><span class="o">.</span><span class="n">columns</span> <span class="p">):</span> <span class="n">col</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">idx</span>  <span class="c1">#re-number</span>
        <span class="c1">#if edep.nColumns == 1 and edep.columns[0].name == &#39;energy&#39;:</span>
        <span class="c1">#    edep.columns, edep.data = [],[] # all widths are constant</span>
        <span class="c1">#    allEliminated = True</span>
        <span class="k">return</span> <span class="n">allEliminated</span></div>
    
<div class="viewcode-block" id="URR_Jsection.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.URR_Jsection.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span> <span class="p">)</span>
        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span>
        <span class="n">indent3</span> <span class="o">=</span> <span class="n">indent2</span> <span class="o">+</span> <span class="n">incrementalIndent</span>

        <span class="n">xmlString</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1"> J=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="p">)</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">URR_Jsection</span><span class="o">.</span><span class="n">optAttrList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1">=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">))</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&gt;&#39;</span>
        <span class="n">constwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constantWidths</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">constwidth</span><span class="p">:</span> <span class="n">xmlString</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constwidth</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">energyDependentWidths</span><span class="p">:</span>
<span class="c1"># BRB6 Hardwried</span>
            <span class="n">xmlString</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;energyDependentWidths&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent2</span><span class="p">)]</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">energyDependentWidths</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent3</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/energyDependentWidths&gt;&#39;</span>
<span class="c1"># BRB6 Hardwried</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span>
        <span class="k">return</span> <span class="n">xmlString</span></div></div>


<span class="c1"># single region (specified by L, J and optionally energy) for which we provide average widths in URR:</span>
<div class="viewcode-block" id="constantWidthSection"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.constantWidthSection">[docs]</a><span class="k">class</span> <span class="nc">constantWidthSection</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    for widths or level spacings that depend only on L and J (not on energy)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optAttrList</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;levelSpacing&#39;</span><span class="p">,</span><span class="s1">&#39;neutronWidth&#39;</span><span class="p">,</span><span class="s1">&#39;captureWidth&#39;</span><span class="p">,</span><span class="s1">&#39;competitiveWidth&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fissionWidthA&#39;</span><span class="p">,</span><span class="s1">&#39;fissionWidthB&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optAttrList</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    
<div class="viewcode-block" id="constantWidthSection.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.constantWidthSection.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span> <span class="p">[</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optAttrList</span> <span class="p">]</span> <span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
        <span class="n">xmlString</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;constantWidths&#39;</span> <span class="o">%</span> <span class="n">indent</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optAttrList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                <span class="n">xmlString</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1">=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span> <span class="n">keepPeriod</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="s1">&#39;/&gt;&#39;</span>
        <span class="k">return</span> <span class="n">xmlString</span></div></div>


<span class="c1"># helper functions for reading in from xml:</span>
<div class="viewcode-block" id="getBool"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.getBool">[docs]</a><span class="k">def</span> <span class="nf">getBool</span><span class="p">(</span> <span class="n">value</span> <span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;true&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}[</span><span class="n">value</span><span class="p">]</span></div>

<div class="viewcode-block" id="floatOrint"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.floatOrint">[docs]</a><span class="k">def</span> <span class="nf">floatOrint</span><span class="p">(</span> <span class="n">value</span> <span class="p">):</span>
    <span class="k">if</span> <span class="nb">float</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span><span class="o">.</span><span class="n">is_integer</span><span class="p">():</span> <span class="k">return</span> <span class="nb">int</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span></div>

<div class="viewcode-block" id="getAttrs"><a class="viewcode-back" href="../../../fudge/fudge.gnd.html#fudge.gnd.resonances.getAttrs">[docs]</a><span class="k">def</span> <span class="nf">getAttrs</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">(),</span> <span class="n">required</span><span class="o">=</span><span class="p">()):</span>
    <span class="sd">&quot;&quot;&quot; read attributes from one xml element. Convert to PhysicalQuantityWithUncertainty (or bool, int, etc)</span>
<span class="sd">    where appropriate, and skip anything in the &#39;exclude&#39; list: &quot;&quot;&quot;</span>
    <span class="n">conversionTable</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;domainMin&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;domainMax&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span><span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">,</span>
            <span class="s1">&#39;neutronWidth&#39;</span><span class="p">:</span><span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">,</span> <span class="s1">&#39;captureWidth&#39;</span><span class="p">:</span><span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">,</span> <span class="s1">&#39;fissionWidthA&#39;</span><span class="p">:</span><span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">,</span> <span class="s1">&#39;fissionWidthB&#39;</span><span class="p">:</span><span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">,</span> <span class="s1">&#39;competitiveWidth&#39;</span><span class="p">:</span><span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">,</span>
            <span class="s1">&#39;levelSpacing&#39;</span><span class="p">:</span><span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">,</span> <span class="s1">&#39;radius&#39;</span><span class="p">:</span><span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">,</span> <span class="s1">&#39;hardSphereRadius&#39;</span><span class="p">:</span><span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">,</span> <span class="s1">&#39;channelSpin&#39;</span><span class="p">:</span><span class="n">spin</span><span class="p">,</span>
            <span class="s1">&#39;reconstructCrossSection&#39;</span><span class="p">:</span><span class="n">getBool</span><span class="p">,</span> <span class="s1">&#39;reconstructAngular&#39;</span><span class="p">:</span><span class="n">getBool</span><span class="p">,</span> <span class="s1">&#39;multipleRegions&#39;</span><span class="p">:</span> <span class="n">getBool</span><span class="p">,</span>
            <span class="s1">&#39;calculateChannelRadius&#39;</span><span class="p">:</span><span class="n">getBool</span><span class="p">,</span> <span class="s1">&#39;computeAngularDistribution&#39;</span><span class="p">:</span><span class="n">getBool</span><span class="p">,</span>
            <span class="s1">&#39;calculateShift&#39;</span><span class="p">:</span><span class="n">getBool</span><span class="p">,</span><span class="s1">&#39;calculatePenetrability&#39;</span><span class="p">:</span><span class="n">getBool</span><span class="p">,</span> <span class="s1">&#39;channelIndex&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;columnIndex&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
            <span class="s1">&#39;LvaluesNeededForConvergence&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;ENDF_MT&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
            <span class="s1">&#39;neutronDOF&#39;</span><span class="p">:</span><span class="n">floatOrint</span><span class="p">,</span> <span class="s1">&#39;gammaDOF&#39;</span><span class="p">:</span><span class="n">floatOrint</span><span class="p">,</span> <span class="s1">&#39;competitiveDOF&#39;</span><span class="p">:</span><span class="n">floatOrint</span><span class="p">,</span> <span class="s1">&#39;fissionDOF&#39;</span><span class="p">:</span><span class="n">floatOrint</span><span class="p">,</span>
            <span class="s1">&#39;spin&#39;</span><span class="p">:</span><span class="n">spin</span><span class="p">,</span> <span class="s1">&#39;parity&#39;</span><span class="p">:</span><span class="n">parity</span><span class="p">,</span> <span class="s1">&#39;boundaryConditionOverride&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
            <span class="p">}</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">element</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">conversionTable</span><span class="p">:</span> <span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">conversionTable</span><span class="p">[</span><span class="n">key</span><span class="p">](</span> <span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">required</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span> <span class="n">attrs</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">attrs</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/gnd.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Fudge and GND 4.2.2 beta documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012, B.Beck, D. Brown, C. Mattoon, N. Patel, N. Summers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>